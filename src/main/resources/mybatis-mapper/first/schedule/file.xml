<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shinvest.ap.schedule.mapper.JobFileMapper">


<!-- 연결 정보 없는 파일 조회 -->
	<select id="selectNotRefFiles" resultType="fileModel">
SELECT FILE_ID,STORAGE_SE,SAVE_PATH,SAVE_FILE_NM,FILE_NM,FILE_EXTSN,FILE_SIZE,USE_YN,RGST_ID,RGST_DT,MODI_ID,MODI_DT,BUCKET_NM,FILE_URL,FILE_CL,SAVE_FILE_VER,REF_ID,REF_VER,ATMC_DEL_YN,ATMC_DEL_DT,DEL_YN
FROM T_FILE
WHERE USE_YN = 'Y' AND DEL_YN = 'N' AND NULLIF(REF_ID,'') IS NULL
	</select>
<!-- 연결 정보 없는 파일 삭제 후 업데이트 -->
	<update id="updateNotRefFile" parameterType="fileModel">
UPDATE T_FILE SET
    USE_YN = 'N'
  , DEL_YN = 'Y'
  , MODI_ID = 'SYSTEM'
  , MODI_DT = NOW()
WHERE FILE_ID = #{fileId}
	</update>




<!-- 대용량 삭제 파일 조회 -->
	<select id="selectAtmcDelFiles" resultType="fileModel">
SELECT FILE_ID,STORAGE_SE,SAVE_PATH,SAVE_FILE_NM,FILE_NM,FILE_EXTSN,FILE_SIZE,USE_YN,RGST_ID,RGST_DT,MODI_ID,MODI_DT,BUCKET_NM,FILE_URL,FILE_CL,SAVE_FILE_VER,REF_ID,REF_VER,ATMC_DEL_YN,ATMC_DEL_DT,DEL_YN
FROM T_FILE
WHERE DEL_YN = 'N' AND ATMC_DEL_YN = 'Y' AND ATMC_DEL_DT &lt; NOW()
	</select>
<!-- 대용량 파일 삭제 후 업데이트 -->
	<update id="updateAtmcDelFile" parameterType="fileModel">
UPDATE T_FILE SET
    DEL_YN = 'Y'
  , MODI_ID = 'SYSTEM'
  , MODI_DT = NOW()
WHERE FILE_ID = #{fileId}
	</update>





</mapper>
