<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shinvest.ap.schedule.mapper.JobLogToFileMapper">

	<sql id="paging">
LIMIT 1000 OFFSET #{pageNo} * 1000
	</sql>





<!-- 공통 - 사용자 -->
	<select id="selectUserCount" resultType="int">
SELECT COUNT(1) AS CNT FROM PTL.T_USER WHERE MODI_SE = 'C' AND USE_YN = 'Y'
	</select>
	<select id="selectUser" parameterType="int" resultType="map">
SELECT TO_CHAR(NOW() - '1 days'::INTERVAL,'YYYY-MM-DD HH24:MI:SS') AS LOG_DT, USER_ID,USER_NM,PSTN_CODE,DEPT_CODE,ADOF_DEPT_CODE,HDEPT_CODE,COMPANY_CODE,DUTY_SE,USE_YN,TO_CHAR(LAST_LOG_DT,'YYYY-MM-DD HH24:MI:SS') AS LAST_LOG_DT,TO_CHAR(START_DT,'YYYY-MM-DD HH24:MI:SS') AS START_DT,TO_CHAR(END_DT,'YYYY-MM-DD HH24:MI:SS') AS END_DT,MODI_SE,RGST_ID,TO_CHAR(RGST_DT,'YYYY-MM-DD HH24:MI:SS') AS RGST_DT,MODI_ID,TO_CHAR(MODI_DT,'YYYY-MM-DD HH24:MI:SS') AS MODI_DT,BF_DEPT_CODE,TO_CHAR(DEPT_UPDT_DT,'YYYY-MM-DD HH24:MI:SS') AS DEPT_UPDT_DT
FROM PTL.T_USER
		<include refid="paging"></include>
	</select>





<!-- 이력 - 사용자 이력 -->
	<select id="selectUserHistCount" resultType="int">
SELECT COUNT(1) AS CNT FROM PTL.T_USER_HIST WHERE HIST_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
	</select>
	<select id="selectUserHist" parameterType="int" resultType="map">
SELECT TO_CHAR(HIST_DT,'YYYY-MM-DD HH24:MI:SS') AS LOG_DT,USER_ID,USER_NM,PSTN_CODE,PSTN_NM,DEPT_CODE,DEPT_NM,ADOF_DEPT_CODE,ADOF_DEPT_NM,HDEPT_CODE,HDEPT_NM,COMPANY_CODE,COMPANY_NM,DUTY_SE,USE_YN,TO_CHAR(LAST_LOG_DT,'YYYY-MM-DD HH24:MI:SS') AS LAST_LOG_DT,TO_CHAR(START_DT,'YYYY-MM-DD HH24:MI:SS') AS START_DT,TO_CHAR(END_DT,'YYYY-MM-DD HH24:MI:SS') AS END_DT,MODI_SE,RGST_ID,TO_CHAR(RGST_DT,'YYYY-MM-DD HH24:MI:SS') AS RGST_DT,MODI_ID,TO_CHAR(MODI_DT,'YYYY-MM-DD HH24:MI:SS') AS MODI_DT,MGR_AUTH_ID,MGR_AUTH_CL,MGR_AUTH_NM,USER_AUTH_ID,USER_AUTH_CL,USER_AUTH_NM,BF_DEPT_CODE,TO_CHAR(DEPT_UPDT_DT,'YYYY-MM-DD HH24:MI:SS') AS DEPT_UPDT_DT,MGR_AUTH_USE_YN,USER_AUTH_USE_YN
FROM PTL.T_USER_HIST
WHERE HIST_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
		<include refid="paging"></include>
	</select>





<!-- 로그 - 관리자 시스템 접속 로그 -->
	<select id="selectRqstMgrSysCount" resultType="int">
SELECT COUNT(1) AS CNT FROM PTL.T_LOG_RQST_MGR_SYS WHERE LOG_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
	</select>
	<select id="selectRqstMgrSys" parameterType="int" resultType="map">
SELECT TO_CHAR(LOG_DT,'YYYY-MM-DD HH24:MI:SS') AS LOG_DT,USER_ID,USER_NM,DEPT_CODE,DEPT_NM,PSTN_CODE,PSTN_NM,CLIENT_IP,SERVER_IP,RQST_URI,RQST_METHOD,METHOD_NM,REGEXP_REPLACE(MSG::TEXT,'( )(?=(?:[^"]|"[^"]*")*$)','','g') AS MSG,AUTH_ID,AUTH_NM,PROGRAM_NM,CONTROLLER_NM
FROM PTL.T_LOG_RQST_MGR_SYS
WHERE LOG_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
		<include refid="paging"></include>
	</select>


<!-- 로그 - 사용자 시스템 접속 로그 -->
	<select id="selectRqstUserSysCount" resultType="int">
SELECT COUNT(1) AS CNT FROM PTL.T_LOG_RQST_USER_SYS WHERE LOG_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
	</select>
	<select id="selectRqstUserSys" parameterType="int" resultType="map">
SELECT TO_CHAR(LOG_DT,'YYYY-MM-DD HH24:MI:SS') AS LOG_DT,USER_ID,USER_NM,DEPT_CODE,DEPT_NM,PSTN_CODE,PSTN_NM,CLIENT_IP,SERVER_IP,RQST_URI,RQST_METHOD,METHOD_NM,REGEXP_REPLACE(MSG::TEXT,'( )(?=(?:[^"]|"[^"]*")*$)','','g') AS MSG,AUTH_ID,AUTH_NM,PROGRAM_NM,CONTROLLER_NM
FROM PTL.T_LOG_RQST_USER_SYS
WHERE LOG_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
		<include refid="paging"></include>
	</select>


<!-- 로그 - 관리자 시스템 태블로 요청 로그 -->
	<select id="selectTableauMgrSysCount" resultType="int">
SELECT COUNT(1) AS CNT FROM PTL.T_LOG_TABLEAU_MGR_SYS WHERE LOG_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
	</select>
	<select id="selectTableauMgrSys" parameterType="int" resultType="map">
SELECT TO_CHAR(LOG_DT,'YYYY-MM-DD HH24:MI:SS') AS LOG_DT,USER_ID,USER_NM,DEPT_CODE,DEPT_NM,PSTN_CODE,PSTN_NM,REPORT_ID,VER,TABLEAU_WORKBOOK_ID,REGEXP_REPLACE(TABLEAU_PARAM::TEXT,'( )(?=(?:[^"]|"[^"]*")*$)','','g') AS TABLEAU_PARAM,TABLEAU_USER_ID
FROM PTL.T_LOG_TABLEAU_MGR_SYS
WHERE LOG_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
		<include refid="paging"></include>
	</select>


<!-- 로그 - 사용자 시스템 태블로 요청 로그 -->
	<select id="selectTableauUserSysCount" resultType="int">
SELECT COUNT(1) AS CNT FROM PTL.T_LOG_TABLEAU_USER_SYS WHERE LOG_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
	</select>
	<select id="selectTableauUserSys" parameterType="int" resultType="map">
SELECT TO_CHAR(LOG_DT,'YYYY-MM-DD HH24:MI:SS') AS LOG_DT,USER_ID,USER_NM,DEPT_CODE,DEPT_NM,PSTN_CODE,PSTN_NM,REPORT_ID,VER,TABLEAU_WORKBOOK_ID,REGEXP_REPLACE(TABLEAU_PARAM::TEXT,'( )(?=(?:[^"]|"[^"]*")*$)','','g') AS TABLEAU_PARAM,TABLEAU_USER_ID
FROM PTL.T_LOG_TABLEAU_USER_SYS
WHERE LOG_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
		<include refid="paging"></include>
	</select>


<!-- 로그 - 포털 관리자 시스템 비즈메타 접속 로그 -->
	<select id="selectBizmetaMgrSysCount" resultType="int">
SELECT COUNT(1) AS CNT FROM PTL.T_LOG_BIZMETA_MGR_SYS WHERE LOG_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
	</select>
	<select id="selectBizmetaMgrSys" parameterType="int" resultType="map">
SELECT TO_CHAR(LOG_DT,'YYYY-MM-DD HH24:MI:SS') AS LOG_DT
FROM PTL.T_LOG_BIZMETA_MGR_SYS
WHERE LOG_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
		<include refid="paging"></include>
	</select>
<!-- 로그 - 포털 사용자 시스템 비즈메타 접속 로그 -->
	<select id="selectBizmetaUserSysCount" resultType="int">
SELECT COUNT(1) AS CNT FROM PTL.T_LOG_BIZMETA_USER_SYS WHERE LOG_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
	</select>
	<select id="selectBizmetaUserSys" parameterType="int" resultType="map">
SELECT TO_CHAR(LOG_DT,'YYYY-MM-DD HH24:MI:SS') AS LOG_DT
FROM PTL.T_LOG_BIZMETA_USER_SYS
WHERE LOG_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
		<include refid="paging"></include>
	</select>


<!-- 로그 - 포털 관리자 시스템 AWS 접속 로그 -->
	<select id="selectAwsMgrSysCount" resultType="int">
SELECT COUNT(1) AS CNT FROM PTL.T_LOG_AWS_MGR_SYS WHERE LOG_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
	</select>
	<select id="selectAwsMgrSys" parameterType="int" resultType="map">
SELECT TO_CHAR(LOG_DT,'YYYY-MM-DD HH24:MI:SS') AS LOG_DT
FROM PTL.T_LOG_AWS_MGR_SYS
WHERE LOG_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
		<include refid="paging"></include>
	</select>
<!-- 로그 - 포털 사용자 시스템 AWS 접속 로그 -->
	<select id="selectAwsUserSysCount" resultType="int">
SELECT COUNT(1) AS CNT FROM PTL.T_LOG_AWS_USER_SYS WHERE LOG_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
	</select>
	<select id="selectAwsUserSys" parameterType="int" resultType="map">
SELECT TO_CHAR(LOG_DT,'YYYY-MM-DD HH24:MI:SS') AS LOG_DT
FROM PTL.T_LOG_AWS_USER_SYS
WHERE LOG_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
		<include refid="paging"></include>
	</select>





<!-- 업무 - 승인 요청 정보 중 승인 상태가 승인완료, 반려(회수) 인 승인 건 -->
	<select id="selectAprvRqstCount" resultType="int">
SELECT COUNT(1) AS CNT FROM PTL.T_APRV_RQST WHERE APRV_STAT IN ('C','R') AND MODI_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
	</select>
	<select id="selectAprvRqst" parameterType="int" resultType="map">
SELECT TO_CHAR(MODI_DT,'YYYY-MM-DD HH24:MI:SS') AS LOG_DT,APRV_ID,REF_ID,REF_VER,APRV_CL,APRV_STAT,APRV_DT,APRVR_ID,DOC_ID,USE_YN,RGST_ID,TO_CHAR(RGST_DT,'YYYY-MM-DD HH24:MI:SS') AS RGST_DT,MODI_ID,TO_CHAR(MODI_DT,'YYYY-MM-DD HH24:MI:SS') AS MODI_DT
FROM PTL.T_APRV_RQST
WHERE APRV_STAT IN ('C','R') AND MODI_DT BETWEEN (CURRENT_DATE - '1 DAYS'::INTERVAL) AND (CURRENT_DATE - '1 SECONDS'::INTERVAL)
		<include refid="paging"></include>
	</select>



</mapper>
